# name: test/sql/erpl_odata_v2_performance.test
# description: Test OData v2 performance and scalability with larger datasets
# group: [erpl_odata]

# Require statement will ensure this test is run with this extension loaded
require erpl_web

statement ok
SET autoinstall_known_extensions=1;

statement ok
SET autoload_known_extensions=1;

# Enable tracing to see what's happening
statement ok
SET erpl_trace_enabled = TRUE;

statement ok
SET erpl_trace_level = 'DEBUG';

statement ok
SET erpl_trace_output = 'console';

# Test 1: OData v2 service with larger dataset (Orders - 50 records)
# Test that we can handle larger entity sets efficiently
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Orders?$top=50&$format=json');
----
50

# Test 2: OData v2 service with complex filtering and selection
# Test that we can handle complex queries efficiently
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Customers?$top=25&$select=CustomerID,CompanyName,ContactName&$format=json');
----
25

# Test 3: OData v2 service with multiple entity types
# Test that we can handle different entity types in sequence
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Products?$top=30&$format=json');
----
30

# Test 4: OData v2 service with pagination simulation
# Test that we can handle multiple requests efficiently
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Order_Details?$top=40&$format=json');
----
40
