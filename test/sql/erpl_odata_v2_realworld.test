# name: test/sql/erpl_odata_v2_realworld.test
# description: Test real-world OData v2 services and edge cases
# group: [erpl_odata]

# Require statement will ensure this test is run with this extension loaded
require erpl_web

statement ok
SET autoinstall_known_extensions=1;

statement ok
SET autoload_known_extensions=1;

# Enable tracing to see what's happening
statement ok
SET erpl_trace_enabled = TRUE;

statement ok
SET erpl_trace_level = 'DEBUG';

statement ok
SET erpl_trace_output = 'console';

# Test 1: OData v2 service with larger dataset (Orders)
# Test that we can handle entity sets with DateTime fields
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Orders?$top=20&$format=json');
----
20

# Test 2: OData v2 service with complex entity (Order Details)
# Test that we can handle entity sets with decimal/numeric fields
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Order_Details?$top=15&$format=json');
----
15

# Test 3: OData v2 service with mixed data types
# Test that we can handle entity sets with various field types
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Employees?$top=5&$format=json');
----
5

# Test 4: OData v2 service with navigation properties
# Test that we can handle entity sets that might have navigation properties
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Suppliers?$top=8&$format=json');
----
8
