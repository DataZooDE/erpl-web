# name: test/sql/erpl_odata_v2_advanced.test
# description: Test advanced OData v2 features like inline count and skip token
# group: [erpl_odata]

# Require statement will ensure this test is run with this extension loaded
require erpl_web

statement ok
SET autoinstall_known_extensions=1;

statement ok
SET autoload_known_extensions=1;

# Enable tracing to see what's happening
statement ok
SET erpl_trace_enabled = TRUE;

statement ok
SET erpl_trace_level = 'DEBUG';

statement ok
SET erpl_trace_output = 'console';

# Test 1: OData v2 service with inline count
# Test that we can access the Northwind service and get customer data
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Customers?$top=5&$format=json');
----
5

# Test 2: OData v2 service with different entity set and larger dataset
# Test that we can access Orders from the Northwind service
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Orders?$top=10&$format=json');
----
10

# Test 3: OData v2 service with complex select clause
# Test that complex column selection works with v2 services
query I
SELECT COUNT(*) FROM odata_read('https://services.odata.org/V2/Northwind/Northwind.svc/Customers?$top=3&$select=CustomerID,CompanyName,ContactName&$format=json');
----
3
